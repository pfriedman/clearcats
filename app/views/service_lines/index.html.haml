- if @user_organizational_units.blank?
  - title "All Service Lines"
- elsif params[:search] and params[:search][:organizational_unit_id_eq].blank?
  - if @user_organizational_units.size == 1
    - title "Service Lines for #{@user_organizational_units.map(&:to_s).to_sentence}"
  - else
    - title "Service Lines"
    = @user_organizational_units.map(&:to_s).to_sentence
- else
  - title "Service Lines for #{OrganizationalUnit.find(params[:search][:organizational_unit_id_eq])}"

- if @user_organizational_units.size > 1
  .page_section
    - form_for @search, :url => {:controller => "service_lines", :action => "index", :method => :get}, :html => {:class => "service_line_search_form"} do |f|
      %p
        = f.label "organizational_unit_id_equals", "Organizational Unit"
        - opts = [["-- Select Organizational Unit --",  ""]] + @user_organizational_units.sort_by{|e| e.name}.map{|u| [u.to_s, u.id]}
        = select_tag("search[organizational_unit_id_eq]", options_for_select(opts, params[:search][:organizational_unit_id_eq].to_i))
        = f.submit "Submit", :disable_with => 'Submitting...'

- if @service_lines.blank?
  %p.no_records
    No service lines were found.
- else
  %table.records
    %tr
      %th= order @search, :by => :name, :as => "Name"
      %th= order @search, :by => :organizational_unit_name, :as => "Organizational Unit"
      %th{ :colspan => '3' }
    - @service_lines.each do |service_line|
      %tr{ :class => cycle('even_record', 'odd_record') }
        %td= h service_line.name
        %td= h service_line.organizational_unit
        %td= link_to 'Show', service_line, :class => "show_link icon_link"
        %td= link_to 'Edit', edit_service_line_path(service_line), :class => "edit_link icon_link"
        %td
          - if service_line.services.blank?
            = link_to 'Delete', service_line, :confirm => 'Are you sure?', :method => :delete, :class => "delete_link icon_link"
.links
  = link_to 'New Service Line', new_service_line_path, :class => "add_link icon_link"